for coreName in `ls /opt/pcf/mfe/core*`;
do
	fileName=$(basename "$coreName")
	echo "Found core file $coreName"
	echo "trying to save gdb ouput"
	if [ ! -f "/tmp/gdb.cmd" ]; then
		echo -e "bt full\nthread apply all bt\nquit"> /tmp/gdb.cmd
	fi
	if [ ! -d "/data/coreOutput/" ];then
		mkdir -p /data/coreOutput/
	fi
 	/usr/bin/gdb /opt/pcf/mfe/bin/MfeServer $coreName -x /tmp/gdb.cmd > /data/coreOutput/$fileName"_dump.txt"

	echo "Going make mfe backup now"
	/bin/tar -zcvf /data/coreOutput/mfelogs_during_$fileName".tgz" /opt/pcf/mfe/log/MfeServer.log* /opt/pcf/mfe/log/.tc.MfeServer.log*

	/usr/bin/top -b -n 1 > /data/coreOutput/top_$fileName".txt"

	/bin/rm -f $coreName
	
	echo "Checkcore";
done
